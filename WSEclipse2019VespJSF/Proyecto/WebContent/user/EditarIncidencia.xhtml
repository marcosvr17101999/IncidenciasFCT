<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<h:head>
<link rel="stylesheet"  href="/Proyecto/resources/css/estilos.css"  />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
<title>Editar Incidencia</title>
	<style>
<!--
textarea {
	resize: none;
	height: 150px;
	width:350px;
	
}
-->
</style>

	<f:metadata>
		<f:viewParam name="incidencia"
			value="#{backingModificacionIncidencia.i}" />
		<f:viewAction action="#{backingModificacionIncidencia.init()}" />

	</f:metadata>
</h:head>
<h:body> 
<div class="enlaces col-12 justify-content-center">
<a href="../user/home.xhtml">Inicio</a>
</div>
<div class="container  ">
<div class="justify-content-center row col-12">
<div class="col-2">
<br></br>
<h4>DATOS DE LA INCIDENCIA</h4><br></br>
<h5>
IdIncidencia</h5>
	<h:outputText class="td" value="#{backingModificacionIncidencia.i.idIncidencia}"></h:outputText>
	<br></br>
<h5>Departamento </h5>
	<h:outputText class="td"
		value="#{backingModificacionIncidencia.i.departamento.detalleDepartamento}"></h:outputText>
	<br></br>
<h5>Estado</h5>
	<h:outputText class="td"
		value="#{backingModificacionIncidencia.i.estadoincidencia.descripcionEstado}"></h:outputText>
	<br></br>
<h5>Fecha </h5>
	<h:outputText class="td"
		value="#{backingModificacionIncidencia.i.fechaIncidenciaF}"></h:outputText>
	<br></br>
<h5>Detalle Incidencia</h5>
	<h:outputText class="td"
		value="#{backingModificacionIncidencia.i.detalleIncidencia}"></h:outputText>
	<br></br>
<h5>Prioridad</h5>
	<h:outputText class="td"
		value="#{backingModificacionIncidencia.i.prioridadBean.descripcionPrioridad}"></h:outputText>
	<br></br>
<h5>Email</h5>
	<h:outputText class="td"
		value="#{backingModificacionIncidencia.i.usuarioBean.email}"></h:outputText>
	<br></br>
	<br></br>
</div>

<div class="col-6 p">
<br></br>
<h4>LISTADO COMENTARIOS</h4><br></br>
<h:panelGroup id="resultadoBusqueda">
	<h:form id="frmResultadoBusquedaIncidencias" >
		<h:dataTable var="incidencia" value="#{backingModificacionIncidencia.i.comentarios}" class="dt c tabla" >
			<f:facet name="header" id="tabla">
				<h:outputText  value="Listado de incidencias"></h:outputText>
			</f:facet>
			<h:column id="idComentario">
				<f:facet name="header">
					<h:outputText value="IdComentario">
					</h:outputText>
				</f:facet>
				<h:outputText value="#{incidencia.idcomentario}">
				</h:outputText>
			</h:column>
			<h:column id="detallesComentario">
				<f:facet name="header">
					<h:outputText value="Comentario">
					</h:outputText>
				</f:facet>
				<h:outputText value="#{incidencia.detallesComentario}">
				</h:outputText>
			</h:column>
			<h:column id="fechaComentario">
				<f:facet name="header">
					<h:outputText value="Fecha">
					</h:outputText>
				</f:facet>
				<h:outputText value="#{incidencia.fechaComentarioF}">
				</h:outputText>
			</h:column>
			<h:column id="emailComentario">
				<f:facet name="header">
					<h:outputText value="Usuario">
					</h:outputText>
				</f:facet>
				<h:outputText value="#{incidencia.usuario.email}">
				</h:outputText>
			</h:column>
		</h:dataTable>
	</h:form>
	<br></br>
	
	</h:panelGroup>
	</div>
	
	<div class="col-4">
<br></br>
<h4>AÃ‘ADIR COMENTARIO</h4><br></br>
	<h:form>
Comentario:
<br></br>
	<h:inputTextarea id="asun"
			value="#{backingModificacionIncidencia.comentario}"></h:inputTextarea>
CAMBIAR A:	
		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==1 and backingModificacionIncidencia.i.estadoincidencia.idEstado==1}">
			
			<f:selectItem itemLabel="Nueva" itemValue="1" />
			<f:selectItem itemLabel="Abierta" itemValue="3" />
			<f:selectItem itemLabel="Rechazada" itemValue="6" />
			<f:ajax render="@all" />
		</h:selectOneMenu>

		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==1 and backingModificacionIncidencia.i.estadoincidencia.idEstado==3}">
			

			<f:selectItem itemLabel="Abierta" itemValue="3" />
			<f:selectItem itemLabel="Espera" itemValue="2" />
			<f:selectItem itemLabel="Resuelta" itemValue="4" />
			<f:ajax render="@all" />
		</h:selectOneMenu>
		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==1 and backingModificacionIncidencia.i.estadoincidencia.idEstado==2}">
		

			<f:selectItem itemLabel="Espera" itemValue="2" />
			<f:selectItem itemLabel="Abierta" itemValue="3" />
			<f:ajax render="@all" />
		</h:selectOneMenu>
		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==1 and backingModificacionIncidencia.i.estadoincidencia.idEstado==4}">
		

			<f:selectItem itemLabel="resuelta" itemValue="4" />
			<f:selectItem itemLabel="Cerrada" itemValue="5" />
			<f:ajax render="@all" />
		</h:selectOneMenu>
<br></br>

		<h:selectOneMenu
			value="#{backingModificacionIncidencia.idDepartamento}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==1 and backingModificacionIncidencia.i.estadoincidencia.idEstado==1 and backingModificacionIncidencia.estado==3}">
			<f:selectItem itemLabel="--Seleccione un departamento--"
				itemDisabled="true" />
			<f:selectItems
				value="#{backingModificacionIncidencia.listadoDepartamentos}"
				var="departamento" itemValue="#{departamento.idDepartamento}"
				itemLabel="#{departamento.detalleDepartamento}" />
		</h:selectOneMenu>

<!--                         IDROL2                        -->
<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==2 and backingModificacionIncidencia.i.estadoincidencia.idEstado==1}">
		
			<f:selectItem itemLabel="Nueva" itemValue="1" />
			<f:selectItem itemLabel="Abierta" itemValue="3" />
			<f:selectItem itemLabel="Rechazada" itemValue="6" />
			<f:ajax render="@all" />
		</h:selectOneMenu>

		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==2 and backingModificacionIncidencia.i.estadoincidencia.idEstado==3}">
			

			<f:selectItem itemLabel="Abierta" itemValue="3" />
			<f:selectItem itemLabel="Espera" itemValue="2" />
			<f:selectItem itemLabel="Resuelta" itemValue="4" />
			<f:ajax render="@all" />
		</h:selectOneMenu>
		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==2 and backingModificacionIncidencia.i.estadoincidencia.idEstado==2}">
			

			<f:selectItem itemLabel="Abierta" itemValue="3" />
			<f:selectItem itemLabel="Espera" itemValue="2" />
			<f:ajax render="@all" />
		</h:selectOneMenu>
		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==2 and backingModificacionIncidencia.i.estadoincidencia.idEstado==4}">
			<f:selectItem itemLabel="resuelta" itemValue="4" />
			<f:selectItem itemLabel="Cerrada" itemValue="5" />
			<f:ajax render="@all" />
		</h:selectOneMenu>
		<br></br>
		
		<h:selectOneMenu
			value="#{backingModificacionIncidencia.idDepartamento}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==2 and backingModificacionIncidencia.i.estadoincidencia.idEstado==1 and backingModificacionIncidencia.estado==3}}">
			<f:selectItem itemLabel="--Seleccione un departamento--"
				itemDisabled="true" />
			<f:selectItems
				value="#{backingModificacionIncidencia.listadoDepartamentos}"
				var="departamento" itemValue="#{departamento.idDepartamento}"
				itemLabel="#{departamento.detalleDepartamento}" />
		</h:selectOneMenu>

<!--                         IDROL3                        -->


		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==3 and backingModificacionIncidencia.i.estadoincidencia.idEstado==3}">
			

			<f:selectItem itemLabel="Abierta" itemValue="3" />
			<f:selectItem itemLabel="Espera" itemValue="2" />
			<f:selectItem itemLabel="Resuelta" itemValue="4" />
			<f:ajax render="@all" />
		</h:selectOneMenu>
		<h:selectOneMenu value="#{backingModificacionIncidencia.estado}"
			rendered="#{backingModificacionIncidencia.u.grupousuario.id.idrol==3 and backingModificacionIncidencia.i.estadoincidencia.idEstado==2}">
			

			<f:selectItem itemLabel="Espera" itemValue="2" />
			<f:selectItem itemLabel="Abierta" itemValue="3" />
			<f:ajax render="@all" />
		</h:selectOneMenu>
		
<!--                         IDROL4                        -->	
		<h:commandButton id="mostrar"
			action="#{backingModificacionIncidencia.guardarVariable()}"
			value="Buscar" >
				<f:ajax execute="@form" render="@all resultadoBusqueda "></f:ajax>
		</h:commandButton>
		<h:messages globalOnly="true" infoClass="advertencia"></h:messages>
	</h:form>
	</div>
	</div>
	</div>
</h:body>
</html>
